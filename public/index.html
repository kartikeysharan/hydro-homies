<!DOCTYPE html>
<html>
<head>
    <title>Hydro Homies Tracker üåä</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #e0f7fa;
        }

        .container {
            text-align: center;
            background: #ffffff;
            padding: 30px 20px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            width: 95%;
            max-width: 450px;
        }

        h1 { color: #00796b; margin-bottom: 5px; }
        h2 { margin-top: 20px; color: #004d40; margin-bottom: 10px; }
        .goal-text { font-size: 1.1rem; color: #00796b; margin-bottom: 20px; }

        button {
            padding: 8px 12px;
            margin: 3px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #26a69a;
            color: white;
            font-weight: bold;
            transition: transform 0.1s;
        }

        button:active { transform: scale(0.95); }
        button:hover { background: #00796b; }

        input {
            width: 50%;
            padding: 8px;
            margin-top: 8px;
            border: 2px solid #b2dfdb;
            border-radius: 8px;
            outline: none;
        }

        /* --- THE WATER PROGRESS BAR --- */
        .progress-container {
            background: #f0f0f0;
            border-radius: 15px;
            height: 40px;
            width: 100%;
            margin: 15px 0 5px 0;
            overflow: hidden;
            position: relative;
            border: 2px solid #b2dfdb;
        }

        .water-fill {
            height: 100%;
            width: 0%;
            background: #4fc3f7;
            position: relative;
            transition: width 1s ease-in-out;
            overflow: hidden;
        }

        /* The Sloshing Wave Animation */
        .water-fill::before {
            content: "";
            position: absolute;
            width: 200%;
            height: 200%;
            top: -150%;
            left: -50%;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 40%;
            animation: wave 4s infinite linear;
        }

        @keyframes wave {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Impact Slosh Shake */
        .slosh-shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(3px) rotate(1deg); }
            50% { transform: translateX(-3px) rotate(-1deg); }
            75% { transform: translateX(2px); }
            100% { transform: translateX(0); }
        }

        .percentage { font-size: 0.85rem; color: #666; font-weight: bold; }
        #winner { font-weight: bold; margin-top: 25px; color: #004d40; font-size: 1.2rem; }

        .reset-btn { background: #e57373; margin-top: 30px; font-size: 0.75rem; }
        .reset-btn:hover { background: #d32f2f; }
    </style>
</head>
<body>
<div class="container">
    <h1>Hydro Homies ‚õ≤</h1>
    <p class="goal-text">Target: <strong>100 oz</strong></p>

    <h2>Kartikey</h2>
    <div class="buttons">
        <button onclick="addWater('you', 16)">+16 oz</button>
        <button onclick="addWater('you', 26)">+26 oz</button>
        <button onclick="addWater('you', 32)">+32 oz</button>
    </div>
    <input type="number" id="your-input" placeholder="Custom">
    <button onclick="addCustom('you')">Add</button>
    <div class="progress-container" id="your-container">
        <div id="your-progress" class="water-fill"></div>
    </div>
    <div class="percentage"><span id="your-total">0</span> / 100 oz (<span id="your-percent">0</span>%)</div>

    <hr style="border: 0; border-top: 1px solid #eee; margin: 25px 0;">

    <h2>Marcee</h2>
    <div class="buttons">
        <button onclick="addWater('friend', 16.9)">+16.9 oz</button>
        <button onclick="addWater('friend', 32)">+32 oz</button>
    </div>
    <input type="number" id="friend-input" placeholder="Custom">
    <button onclick="addCustom('friend')">Add</button>
    <div class="progress-container" id="friend-container">
        <div id="friend-progress" class="water-fill" style="background: #29b6f6;"></div>
    </div>
    <div class="percentage"><span id="friend-total">0</span> / 100 oz (<span id="friend-percent">0</span>%)</div>

    <div id="winner">Let's get hydrated! üò§üíß</div>
    <button class="reset-btn" onclick="resetDay()">Reset Tracker</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCfMLAnZKb7cAiEwliEnCtrpwIoKOjr1kg",
  authDomain: "hydro-homies-458f6.firebaseapp.com",
  projectId: "hydro-homies-458f6",
  storageBucket: "hydro-homies-458f6.firebasestorage.app",
  messagingSenderId: "533318428966",
  appId: "1:533318428966:web:3f9ee356e1e3c0b3c939e7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const hydrationRef = ref(db, "hydration");
const goal = 100;

let yourTotal = 0;
let friendTotal = 0;
let kFinished = false;
let mFinished = false;

onValue(hydrationRef, (snapshot) => {
    const data = snapshot.val();
    if (data) {
        yourTotal = data.yourTotal || 0;
        friendTotal = data.friendTotal || 0;
    }
    updateUI(false);
});

function saveData() {
    set(hydrationRef, {
        yourTotal: parseFloat(yourTotal.toFixed(1)),
        friendTotal: parseFloat(friendTotal.toFixed(1)),
        lastUpdated: serverTimestamp()
    });
}

function celebrate() {
    const duration = 3000;
    const end = Date.now() + duration;

    (function frame() {
        confetti({
            particleCount: 5,
            angle: 60,
            spread: 55,
            origin: { x: 0, y: 0.7 },
            colors: ['#ff0000', '#ffd700']
        });
        confetti({
            particleCount: 5,
            angle: 120,
            spread: 55,
            origin: { x: 1, y: 0.7 },
            colors: ['#ff0000', '#ffd700']
        });
        if (Date.now() < end) requestAnimationFrame(frame);
    }());
}

function updateUI(shouldSave = true) {
    const yourBar = document.getElementById("your-progress");
    const friendBar = document.getElementById("friend-progress");
    const yourCont = document.getElementById("your-container");
    const friendCont = document.getElementById("friend-container");

    document.getElementById("your-total").innerText = yourTotal.toFixed(1);
    document.getElementById("friend-total").innerText = friendTotal.toFixed(1);

    let yourPercent = (yourTotal / goal) * 100;
    let friendPercent = (friendTotal / goal) * 100;

    if (yourPercent >= 100 && !kFinished) { celebrate(); kFinished = true; }
    if (friendPercent >= 100 && !mFinished) { celebrate(); mFinished = true; }

    yourBar.style.width = Math.min(yourPercent, 100) + "%";
    friendBar.style.width = Math.min(friendPercent, 100) + "%";

    document.getElementById("your-percent").innerText = Math.floor(yourPercent);
    document.getElementById("friend-percent").innerText = Math.floor(friendPercent);

    // Physical Slosh Effect
    if (shouldSave) {
        yourCont.classList.add("slosh-shake");
        friendCont.classList.add("slosh-shake");
        setTimeout(() => {
            yourCont.classList.remove("slosh-shake");
            friendCont.classList.remove("slosh-shake");
        }, 500);
        saveData();
    }

    updateWinner();
}

window.addWater = function(person, amount) {
    if (person === "you") yourTotal += amount;
    else friendTotal += amount;
    updateUI(true);
};

window.addCustom = function(person) {
    const inputId = person === "you" ? "your-input" : "friend-input";
    let val = parseFloat(document.getElementById(inputId).value);
    if (!isNaN(val) && val > 0) {
        if (person === "you") yourTotal += val;
        else friendTotal += val;
        document.getElementById(inputId).value = "";
        updateUI(true);
    }
};

function updateWinner() {
    let winDiv = document.getElementById("winner");
    if (yourTotal > friendTotal) winDiv.innerText = "üèÜ Kartikey is winning!";
    else if (friendTotal > yourTotal) winDiv.innerText = "üèÜ Marcee is winning!";
    else winDiv.innerText = "It's a tie! Drink up! üò§üíß";
}

window.resetDay = function() {
    if(confirm("Reset all water for today?")) {
        yourTotal = 0;
        friendTotal = 0;
        kFinished = false;
        mFinished = false;
        updateUI(true);
    }
};
</script>
</body>
</html>
