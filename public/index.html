<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Hydro Homies üåä</title>

<style>
:root {
    --safe-top: env(safe-area-inset-top);
    --safe-bottom: env(safe-area-inset-bottom);
}

html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    background: #e0f7fa;
    overscroll-behavior: none;
}

body {
    display: flex;
    justify-content: center;
    font-family: -apple-system, system-ui, sans-serif;
}

.container {
    text-align: center;
    background: #ffffff;
    width: 100%;
    max-width: 430px;
    min-height: 100%;
    padding: calc(var(--safe-top) + 15px) 25px calc(var(--safe-bottom) + 25px) 25px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
}

.header-section { margin-bottom: 15px; }

h1 { color: #00796b; margin: 5px 0; font-size: 2.2rem; font-weight: 800; }

.player-header {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
}

h2 { margin: 0; font-size: 1.8rem; font-weight: 700; }

.crown {
    font-size: 1.2rem;
    display: inline-block;
}

.streak-badge {
    font-size: 0.9rem;
    background: #fff3e0;
    color: #ef6c00;
    padding: 4px 10px;
    border-radius: 12px;
    font-weight: bold;
}

.btn-group {
    margin: 10px 0;
    display: flex;
    justify-content: center;
    gap: 8px;
}

button.oz-btn {
    flex: 1;
    padding: 12px 0;
    border: none;
    border-radius: 12px;
    background: #26a69a;
    color: white;
    font-weight: bold;
    font-size: 1rem;
}

input {
    width: 80px;
    height: 45px;
    border: 2px solid #e0f2f1;
    border-radius: 12px;
    font-size: 16px;
    text-align: center;
}

button.add-btn {
    height: 45px;
    padding: 0 20px;
    background: #00796b;
    border-radius: 12px;
    color: white;
    border: none;
    font-weight: bold;
}

.progress-container {
    background: #f1f1f1;
    border-radius: 12px;
    height: 22px;
    width: 100%;
    margin: 15px 0 6px 0;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #4fc3f7, #00796b);
    transition: width 0.5s ease;
}

.percentage {
    font-size: 1rem;
    font-weight: 700;
    color: #455a64;
}

#winner-container {
    padding-top: 15px;
    margin-top: auto;
    border-top: 2px solid #f1f1f1;
}

#winner {
    font-weight: 900;
    color: #004d40;
    font-size: 1.2rem;
}
</style>
</head>

<body>
<div class="container">

<div class="header-section">
<h1>Hydro Homies üíß</h1>
</div>

<!-- Kartikey -->
<div class="player-section">
<div class="player-header">
<span id="k-crown" class="crown">üëë <span id="k-wins">0</span></span>
<h2>Kartikey</h2>
<div class="streak-badge">üî• <span id="k-streak">0</span></div>
</div>

<div class="btn-group">
<button class="oz-btn" onclick="addWater('you',16)">16</button>
<button class="oz-btn" onclick="addWater('you',26)">26</button>
<button class="oz-btn" onclick="addWater('you',32)">32</button>
</div>

<div class="progress-container">
<div id="your-progress" class="progress-bar"></div>
</div>

<div class="percentage"><span id="your-total">0</span> / 100 oz</div>
</div>

<hr>

<!-- Marcee -->
<div class="player-section">
<div class="player-header">
<span id="m-crown" class="crown">üëë <span id="m-wins">0</span></span>
<h2>Marcee</h2>
<div class="streak-badge">üî• <span id="m-streak">0</span></div>
</div>

<div class="btn-group">
<button class="oz-btn" onclick="addWater('friend',16)">16</button>
<button class="oz-btn" onclick="addWater('friend',32)">32</button>
</div>

<div class="progress-container">
<div id="friend-progress" class="progress-bar"></div>
</div>

<div class="percentage"><span id="friend-total">0</span> / 100 oz</div>
</div>

<div id="winner-container">
<div id="winner">The Hydration War Begins ‚öîÔ∏è</div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
apiKey: "AIzaSyCfMLAnZKb7cAiEwliEnCtrpwIoKOjr1kg",
authDomain: "hydro-homies-458f6.firebaseapp.com",
projectId: "hydro-homies-458f6",
storageBucket: "hydro-homies-458f6.firebasestorage.app",
messagingSenderId: "533318428966",
appId: "1:533318428966:web:3f9ee356e1e3c0b3c939e7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const hydrationRef = ref(db, "hydration");

const goal = 100;

let yourTotal=0, friendTotal=0;
let kStreak=0, mStreak=0;
let kWins=0, mWins=0;
let weekStartDate="", lastResetDate="";

onValue(hydrationRef,(snapshot)=>{
const data=snapshot.val();
if(data){
yourTotal=data.yourTotal||0;
friendTotal=data.friendTotal||0;
kStreak=data.kStreak||0;
mStreak=data.mStreak||0;
kWins=data.kWins||0;
mWins=data.mWins||0;
weekStartDate=data.weekStartDate||"";
lastResetDate=data.lastResetDate||"";

const today=new Date().toLocaleDateString();
if(lastResetDate && lastResetDate!==today){
handleMidnightReset();
return;
}
}
updateUI();
});

function handleMidnightReset(){
const today=new Date();
const todayStr=today.toLocaleDateString();

if(!weekStartDate) weekStartDate=todayStr;

const start=new Date(weekStartDate);
const diff=Math.floor((today-start)/(1000*60*60*24));

if(diff>=7){
kWins=0;
mWins=0;
weekStartDate=todayStr;
}

if(yourTotal>friendTotal) kWins++;
else if(friendTotal>yourTotal) mWins++;

set(hydrationRef,{
yourTotal:0,
friendTotal:0,
kStreak:yourTotal>=goal?kStreak+1:0,
mStreak:friendTotal>=goal?mStreak+1:0,
kWins,mWins,
weekStartDate,
lastResetDate:todayStr,
lastUpdated:serverTimestamp()
});
}

function updateUI(){
document.getElementById("your-total").innerText=yourTotal.toFixed(1);
document.getElementById("friend-total").innerText=friendTotal.toFixed(1);
document.getElementById("k-streak").innerText=kStreak;
document.getElementById("m-streak").innerText=mStreak;
document.getElementById("k-wins").innerText=kWins;
document.getElementById("m-wins").innerText=mWins;

document.getElementById("your-progress").style.width=Math.min((yourTotal/goal)*100,100)+"%";
document.getElementById("friend-progress").style.width=Math.min((friendTotal/goal)*100,100)+"%";

let winDiv=document.getElementById("winner");
if(yourTotal>friendTotal) winDiv.innerText="üèÜ KARTIKEY IS LEADING!";
else if(friendTotal>yourTotal) winDiv.innerText="üèÜ MARCEE IS LEADING!";
else winDiv.innerText="HYDRATION WAR TIED üò§";
}

window.addWater=function(p,a){
if(p==="you") yourTotal+=a;
else friendTotal+=a;
updateUI();
set(hydrationRef,{
yourTotal,friendTotal,kStreak,mStreak,kWins,mWins,
weekStartDate,
lastResetDate:lastResetDate||new Date().toLocaleDateString(),
lastUpdated:serverTimestamp()
});
}
</script>

</body>
</html>
